

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>云原生应用的12要素 &mdash; 学习方法 v1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="企业架构演化" href="enterprise_architecture.html" />
    <link rel="prev" title="云原生相关" href="../4cloudnative.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> 学习方法
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0source.html">源码学习</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../0sources/learn-method.html">如何高效学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../0sources/why-read-code.html">为何阅读源码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../0sources/how-to-read-code.html">如何阅读源码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../0sources/efficient-read-code.html">如何高效阅读源码</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../1job.html">招聘&amp;面试</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../1jobs/how-to-hire-person.html">如何招聘到合适的人</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1jobs/my-how-to-hire-person.html">我的面试总结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1jobs/how-to-good-architect.html">如何成为一个好的架构师</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1jobs/team-platform.html">平台型团队</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../3tech.html">技术相关</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../3techs/data-analysis.html">数据分析</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3techs/architecture-diagram.html">架构图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3techs/architecture-c4-model.html">软件架构——C4模型</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../3techs/architecture-c4-model.html#id1">参考</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../3techs/compiler.html">编译原理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3techs/encrypts.html">加密相关</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../4cloudnative.html">云原生相关</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">云原生应用的12要素</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">参考</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="enterprise_architecture.html">企业架构演化</a><ul>
<li class="toctree-l3"><a class="reference internal" href="enterprise_architecture.html#id2">参考</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Severless.html">Severless</a></li>
<li class="toctree-l2"><a class="reference internal" href="learning.html">云原生学习</a><ul>
<li class="toctree-l3"><a class="reference internal" href="learnings/lesson1.html">1. 起点</a></li>
<li class="toctree-l3"><a class="reference internal" href="learnings/lesson2.html">容器基本概念</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../7design.html">设计相关</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../7designs/design_thinking.html">设计思维</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../7designs/design_thinking.html#id2">扩展阅读</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../8psychology.html">心理学</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../8psychologys/iceberg_theory.html">冰山理论</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../8psychologys/iceberg_theory.html#id2">扩展阅读</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../9brief.html">简理</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../9briefs/demo1.html">实例一</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../9surrounding.html">周边</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../9surroundings/3gpp.html">3gpp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../9surroundings/3gpp.html#id1">参考</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">学习方法</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../4cloudnative.html">云原生相关</a> &raquo;</li>
        
      <li>云原生应用的12要素</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/4cloudnatives/12Factor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>云原生应用的12要素<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p class="plantuml">
<object data="../_images/plantuml-5588ea52ac9f9c863543d9290c69af93251472f8.svg" type="image/svg+xml" style="width:1381px;height:7701px;">
<img src="../_images/plantuml-5588ea52ac9f9c863543d9290c69af93251472f8.png" alt="&#64;startmindmap

* 云原生12要素
** 方法论
*** 标准化流程自动配置
**** 使新的开发者花费最少的学习成本加入
*** 操作系统间划清界限
**** 在各个系统中提供最大的可移植性
*** 适合部署在现代的云平台
**** 为在服务器和系统管理方面节省资源
*** 降低开发环境和生产环境的差异
**** 使用持续交付
**** 实施敏捷开发
*** 实现扩展
**** 在工具、架构和开发流程不发生明显变化的前提下
*** 语言无关性
**** 这套理论适用于任意语言和后端服务开发的app

** 灵感
*** 作者: Martin Fowler
*** Patterns of Enterprise Application Architecture， Refactoring

** 1.基准代码
*** 一份基准代码（Codebase），多份部署（deploy）
*** 一旦有多个基准代码，就不能称为一个应用，而是一个分布式系统
**** 分布式系统中的每一个组件都是一个应用
**** 每一个应用可以分别使用 12-Factor 进行开发
*** 多个应用共享一份基准代码是有悖于 12-Factor 原则的
**** 解决方案是将共享的代码拆分为独立的类库
**** 然后使用 依赖管理 策略去加载它们
*** 每个应用可同时存在多份部署
**** 每份 部署 相当于运行了一个应用的实例
**** 通常有多个环境: dev, deploy, local...
**** 每个环境可能有多份部署
**** 不同环境间可使用不同版本但都共享同一基准代码

** 2.依赖
*** 显式声明依赖关系
**** 不会隐式依赖某些系统工具
**** 即使这些工具存在于几乎所有系统: 如curl
*** Ruby
**** 使用 Gemfile 作为依赖项声明清单
**** 使用 bundle exec 来进行依赖隔离
*** Python
**** Pip 用作依赖声明
**** Virtualenv 用作依赖隔离
*** C
**** Autoconf 用作依赖声明
**** 静态链接库用作依赖隔离
*** 注意
**** 无论用什么工具，依赖声明和依赖隔离必须一起使用
**** 否则无法满足 12-Factor 规范
*** 显式声明依赖的优点
**** 为新进开发者简化了环境配置流程
**** 通过一个 构建命令 安装所有的依赖项

** 3.配置
*** 在环境中存储配置
**** 代码和配置严格分离
**** 配置文件在各部署间存在大幅差异，代码却完全一致
**** 标准: 基准代码立刻开源，而不用担心会暴露任何敏感的信息
**** 推荐: 将应用的配置存储于 环境变量 中（ env vars, env ）
*** 配置 在不同 部署环境 会有很大差异
**** 这其中包括
**** 数据库，Memcached，以及其他 后端服务 的配置
**** 第三方服务的证书，如 Amazon S3、Twitter 等
**** 每份部署特有的配置，如域名等
*** 分组
**** 应用将配置按照特定部署进行分组（或叫做“环境”）
**** 如: development,test, 和 production 环境
**** 这将导致各种配置组合的激增
*** 要求
**** 环境变量的粒度要足够小，且相对独立
**** 不会组合成一个所谓的“环境”
**** 而是独立存在于每个部署之中
**** 在扩展需要更多种类的部署时，能够做到平滑过渡



** 4.后端服务
*** 把后端服务(backing services)当作附加资源
**** 后端服务是指程序运行所需要的通过网络调用的各种服务
**** 如数据库、消息/队列等
*** 不区别对待本地或第三方服务
**** 对应用程序而言，两种都是附加资源
**** 通过一个 url 或是其他来获取数据
*** 这些资源和它们附属的部署保持松耦合
**** 部署可以按需加载或卸载资源




** 5.构建，发布，运行
*** 严格分离构建和运行
**** 严格区分构建，发布，运行这三个步骤

*** 基准代码 转化为一份部署
**** 构建阶段
***** 将代码仓库转化为可执行包的过程
***** 构建时会使用指定版本的代码
**** 发布阶段
***** 将构建的结果和当前部署所需 配置 相结合
***** 并能够立刻在运行环境中投入使用
**** 运行阶段
***** 针对选定的发布版本，在执行环境中启动一系列应用程序 进程

*** 建议
**** 运行阶段
***** 不一定需要人为触发，也可以自动进行
***** 运行阶段应该保持尽可能少的模块
**** 构建阶段
***** 需要开发人员触发构建操作
***** 是可以相对复杂一些的
***** 因为错误信息能够立刻展示在开发人员面前
***** 从而得到妥善处理


** 6.进程
*** 以一个或多个无状态进程运行应用
**** 应用的进程必须无状态且 无共享
**** 任何需要持久化的数据都要存储在 后端服务 内
*** 粘性 session 是 12-Factor 极力反对的
**** 粘性 session是指将用户 session 中的数据缓存至某进程的内存中
**** 并将同一用户的后续请求路由到同一个进程
**** Session 的数据应存在带有过期时间的缓存中



** 7.端口绑定
*** 通过端口绑定(Port binding)来提供服务
**** 应用完全自我加载 不依赖于任何网络服务器就可以创建一个面向网络的服务
*** 实现思路
**** 将网络服务器类库通过 依赖声明 载入应用
**** 调用方将服务方提供的相应 URL 当作资源存入 配置 以备将来调用


** 8.并发
*** 通过进程模型进行扩展
**** 在 12-factor 应用中，进程是一等公民
**** 主要借鉴于 unix 守护进程模型
**** 12-Factor 应用的进程所具备的无共享，水平分区的特性 意味着添加并发会变得简单而稳妥
*** 12-Factor 应用的进程 不需要守护进程 或是写入 PID 文件
**** 相反的，应该借助操作系统的进程管理器来管理 输出流
**** 响应崩溃的进程，以及处理用户触发的重启和关闭超级进程的请求



** 9.易处理
*** 快速启动和优雅终止可最大化健壮性
**** 12-Factor 应用的 进程 是 易处理（disposable）的
***** 意思是说它们可以瞬间开启或停止
***** 有利于快速、弹性的伸缩应用
***** 迅速部署变化的 代码 或 配置 ，稳健的部署应用
**** 12-Factor 应用都应设计能应对意外、不优雅的终结
***** Crash-only design
***** 将这种概念转化为 合乎逻辑的理论

*** 进程应当追求 最小启动时间
**** 更少的启动时间提供了更敏捷的 发布 以及扩展过程
**** 还增加了健壮性
***** 因为进程管理器可以在授权情形下很容易的将进程搬到新的物理机器上
*** 进程 一旦接收 终止信号（SIGTERM） 就会优雅的终止

**** 就网络进程而言
***** 优雅终止是指停止监听服务的端口
***** 即拒绝所有新的请求，并继续执行当前已接收的请求，然后退出
***** 隐含的要求
****** HTTP请求大多都很短(不会超过几秒钟)
****** 而在长时间轮询中，客户端在丢失连接后应该马上尝试重连

**** 对于 worker 进程来说
***** 优雅终止是指将当前任务退回队列
***** RabbitMQ 中
****** worker 可以发送一个NACK信号
***** Beanstalkd 中
****** 任务终止并退回队列会在worker断开时自动触发
***** 锁机制的系统诸如 Delayed Job
****** 需要确定释放了系统资源
****** 隐含的要求
****** 任务都应该 可重复执行
****** 主要由将结果包装进事务
****** 或是使重复操作 幂等 来实现

*** 进程还应当在面对突然死亡时保持健壮
**** 如底层硬件故障
***** 情况比起优雅终止出现要少
***** 但还是可能出现
**** 推荐的方式
***** 使用一个健壮的后端队列，例如 Beanstalkd
****** 在客户端断开或超时后自动退回任务


** 10.开发环境与线上环境等价
*** 尽可能的保持开发，预发布，线上环境相同
**** 开发环境和线上环境3个主差异
**** 时间差异
***** 开发人员正在编写的代码可能需要几天，几周，甚至几个月才会上线
**** 人员差异
***** 开发人员编写代码
***** 运维人员部署代码
**** 工具差异
***** 开发人员或许使用 Nginx，SQLite，OS X
***** 而线上环境使用 Apache，MySQL 以及 Linux

*** 12-Factor 应用想要做到 持续部署
**** 就必须缩小本地与线上差异
**** 缩小时间差异
***** 开发人员可以几小时，甚至几分钟就部署代码
**** 缩小人员差异
***** 开发人员不只要编写代码
***** 更应该密切参与部署过程以及代码在线上的表现
**** 缩小工具差异
***** 尽量保证开发环境以及线上环境的一致性

*** 12-Factor 应用的开发人员应反对在不同环境使用不同的后端服务
**** 即使适配器已经可以几乎消除使用上的差异
**** 不同的后端服务意味着会突然出现的不兼容
***** 导致测试、预发布都正常的代码在线上出现问题
**** 这些错误会给持续部署带来阻力
***** 从应用程序的生命周期来看
***** 消除这种阻力需要花费很大的代价
**** 与此同时
***** 借助Homebrew，apt-get等现代的打包系统
***** 后端服务的安装与运行并不复杂
***** 使用类似 Chef 和 Puppet 的声明式配置工具
***** 结合像 Vagrant 这样轻量的虚拟环境
***** 可使开发人员的本地环境与线上环境无限接近

*** 注:不同后端服务的适配器仍有用
**** 可以使移植后端服务变得简单
**** 但应用的所有部署
***** 这其中包括开发、预发布以及线上环境
***** 都应该使用同一个后端服务的相同版本

** 11.日志
*** 把日志当作事件流
**** 日志应该是 事件流 的汇总
**** 将所有进程输出流按照时间顺序收集起来
*** 12-factor应用本身从不考虑存储自己的输出流
**** 不应该试图去写或者管理日志文件
**** 相反，每一运行的进程都会直接的标准输出（stdout）事件流
**** 开发环境
***** 开发人员可以通过这些数据流，实时在终端看到应用的活动
**** 预发布或线上部署
***** 每个进程的输出流由运行环境截获，并将其他输出流整理在一起
***** 然后一并发送给一个或多个最终的处理程序，用于查看或是长期存档
***** 这些存档路径对于应用来说不可见也不可配置
***** 是完全交给程序的运行环境管理
***** 类似 Logplex 和 Fluent 的开源工具可实现
***** 最重要的
****** 输出流可以发送到 Splunk 这样的日志索引及分析系统
****** 或 Hadoop/Hive 这样的通用数据存储系统
****** 这些系统为查看应用的历史活动提供了强大而灵活的功能

** 12.管理进程
*** 进程构成（process formation）
**** 指用来处理应用的常规业务（比如处理 web 请求）的一组进程
*** 把后台管理任务当作一次性进程运行
**** 开发人员经常希望执行一些管理或维护应用的一次性任务
***** 运行一个控制台（也被称为 REPL shell）
***** 运行一些提交到代码仓库的一次性脚本

*** 一次性管理进程应该和正常的 常驻进程 使用同样的环境
**** 这些管理进程和常驻进程使用相同的 代码 和 配置
**** 基于某个 发布版本 运行
**** 后台管理代码应随常驻app代码一起发布，避免同步问题
**** 所有进程类型应该使用同样的 依赖隔离 技术

*** 12-factor 青睐提供了 REPL shell 的语言
**** 那会让运行一次性脚本变得简单
**** 在本地部署中
***** 开发人员直接在命令行使用 shell 命令调用一次性管理进程
**** 在线上部署中
***** 开发人员依旧可以使用ssh等来运行这样的进程







&#64;endmindmap"/>

</object></p>
<div class="section" id="id2">
<h2>参考<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://cloud.tencent.com/developer/article/1034398">https://cloud.tencent.com/developer/article/1034398</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="enterprise_architecture.html" class="btn btn-neutral float-right" title="企业架构演化" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../4cloudnative.html" class="btn btn-neutral" title="云原生相关" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, 赵卫国.

    </p>
  </div>
  <div>备案号 <a href="http://www.beian.miit.gov.cn">京ICP备16018553号</a></div><div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a></div>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>